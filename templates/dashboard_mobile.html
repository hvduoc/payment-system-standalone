{% extends "payment_layout.html" %}

{% block title %}Dashboard - H·ªá th·ªëng Thu Chi{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-4 md:py-6">
    <!-- Welcome Header - Mobile Optimized -->
    <div class="mb-6">
        <div class="bg-gradient-to-r from-green-500 to-blue-600 rounded-xl p-4 md:p-6 text-white">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div class="mb-3 md:mb-0">
                    <h2 class="text-xl md:text-2xl font-bold">Ch√†o m·ª´ng, {{ user.full_name }}!</h2>
                    <p class="text-green-100 text-sm md:text-base">{{ getRoleDisplayName(user.role) }} - H·ªá th·ªëng Thu Chi Airbnb</p>
                </div>
                <div class="text-sm md:text-base">
                    <div class="flex items-center mb-1">
                        <i class="fas fa-clock mr-2"></i>
                        <span data-time="current">{{ getVietnamTime().strftime('%H:%M:%S %d/%m/%Y') if getVietnamTime else '' }}</span>
                    </div>
                    <div class="text-green-100">
                        <i class="fas fa-server mr-2"></i>
                        Standalone v2.0
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Cards - Mobile First -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-6">
        <div class="bg-white rounded-lg shadow p-3 md:p-4 text-center">
            <div class="text-2xl md:text-3xl mb-1 text-green-600">{{ recent_payments|length }}</div>
            <div class="text-xs md:text-sm text-gray-600">Kho·∫£n thu g·∫ßn ƒë√¢y</div>
        </div>
        <div class="bg-white rounded-lg shadow p-3 md:p-4 text-center">
            <div class="text-2xl md:text-3xl mb-1 text-blue-600">{{ recent_handovers|length }}</div>
            <div class="text-xs md:text-sm text-gray-600">B√†n giao g·∫ßn ƒë√¢y</div>
        </div>
        <div class="bg-white rounded-lg shadow p-3 md:p-4 text-center">
            <div class="text-2xl md:text-3xl mb-1 text-purple-600">5</div>
            <div class="text-xs md:text-sm text-gray-600">T√≤a nh√†</div>
        </div>
        <div class="bg-white rounded-lg shadow p-3 md:p-4 text-center">
            <div class="text-2xl md:text-3xl mb-1 text-orange-600">3</div>
            <div class="text-xs md:text-sm text-gray-600">Nh√¢n vi√™n</div>
        </div>
    </div>

    <!-- Quick Action Buttons - Mobile Optimized -->
    <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Thao t√°c nhanh</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <a href="/admin/payments" class="bg-green-500 hover:bg-green-600 text-white rounded-lg p-4 text-center transition-colors">
                <i class="fas fa-plus-circle text-2xl mb-2 block"></i>
                <span class="text-sm font-medium">Th√™m thu</span>
            </a>
            
            <a href="/admin/handovers" class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg p-4 text-center transition-colors">
                <i class="fas fa-exchange-alt text-2xl mb-2 block"></i>
                <span class="text-sm font-medium">B√†n giao</span>
            </a>
            
            <a href="/admin/payments" class="bg-purple-500 hover:bg-purple-600 text-white rounded-lg p-4 text-center transition-colors">
                <i class="fas fa-list text-2xl mb-2 block"></i>
                <span class="text-sm font-medium">Xem thu</span>
            </a>
            
            {% if user.role == 'owner' %}
            <a href="/admin/users" class="bg-orange-500 hover:bg-orange-600 text-white rounded-lg p-4 text-center transition-colors">
                <i class="fas fa-users text-2xl mb-2 block"></i>
                <span class="text-sm font-medium">ƒê·ªôi ng≈©</span>
            </a>
            {% else %}
            <a href="/admin/reports" class="bg-gray-500 hover:bg-gray-600 text-white rounded-lg p-4 text-center transition-colors">
                <i class="fas fa-chart-bar text-2xl mb-2 block"></i>
                <span class="text-sm font-medium">B√°o c√°o</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Recent Activities - Mobile Responsive -->
    <div class="grid md:grid-cols-2 gap-4 md:gap-6">
        <!-- Recent Payments -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-receipt text-green-600 mr-2"></i>
                        Thu g·∫ßn ƒë√¢y
                    </h3>
                    <a href="/admin/payments" class="text-green-600 text-sm hover:underline">Xem t·∫•t c·∫£</a>
                </div>
            </div>
            <div class="p-4">
                {% if recent_payments %}
                    <div class="space-y-3">
                        {% for payment in recent_payments[:3] %}
                        <div class="flex justify-between items-start p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-gray-900 truncate">{{ payment.guest_name }}</p>
                                <p class="text-sm text-gray-500">{{ payment.booking_id }}</p>
                                <p class="text-xs text-gray-400">{{ payment.created_at.strftime('%d/%m %H:%M') if payment.created_at else '' }}</p>
                            </div>
                            <div class="text-right ml-2 flex-shrink-0">
                                <p class="text-sm font-semibold text-green-600">{{ "{:,.0f}".format(payment.amount_collected) }} ‚Ç´</p>
                                <p class="text-xs text-gray-500">{{ payment.payment_method }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-inbox text-gray-300 text-3xl mb-3"></i>
                        <p class="text-gray-500 mb-3">Ch∆∞a c√≥ kho·∫£n thu n√†o</p>
                        <a href="/admin/payments" class="inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">
                            <i class="fas fa-plus mr-2"></i>Th√™m kho·∫£n thu
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Recent Handovers -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-handshake text-blue-600 mr-2"></i>
                        B√†n giao g·∫ßn ƒë√¢y
                    </h3>
                    <a href="/admin/handovers" class="text-blue-600 text-sm hover:underline">Xem t·∫•t c·∫£</a>
                </div>
            </div>
            <div class="p-4">
                {% if recent_handovers %}
                    <div class="space-y-3">
                        {% for handover in recent_handovers[:3] %}
                        <div class="flex justify-between items-start p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-gray-900 truncate">{{ handover.from_person }} ‚Üí {{ handover.to_person }}</p>
                                <p class="text-xs text-gray-400">{{ handover.created_at.strftime('%d/%m %H:%M') if handover.created_at else '' }}</p>
                            </div>
                            <div class="text-right ml-2 flex-shrink-0">
                                <p class="text-sm font-semibold text-blue-600">{{ "{:,.0f}".format(handover.amount) }} ‚Ç´</p>
                                <span class="inline-block px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">{{ handover.status }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-inbox text-gray-300 text-3xl mb-3"></i>
                        <p class="text-gray-500 mb-3">Ch∆∞a c√≥ b√†n giao n√†o</p>
                        <a href="/admin/handovers" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Th√™m b√†n giao
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Mobile Tips -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4 md:hidden">
        <h4 class="font-medium text-blue-900 mb-2">üí° M·∫πo s·ª≠ d·ª•ng tr√™n mobile:</h4>
        <ul class="text-sm text-blue-800 space-y-1">
            <li>‚Ä¢ Vu·ªët sang tr√°i/ph·∫£i ƒë·ªÉ xem th√™m th√¥ng tin</li>
            <li>‚Ä¢ Nh·∫•n gi·ªØ ƒë·ªÉ xem menu thao t√°c</li>
            <li>‚Ä¢ D√πng n√∫t nhanh ·ªü tr√™n cho c√°c t√°c v·ª• th∆∞·ªùng d√πng</li>
        </ul>
    </div>
</div>

<style>
    /* Mobile-first responsive styles */
    @media (max-width: 768px) {
        .container {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        /* Touch-friendly buttons */
        a, button {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Better text sizing for mobile */
        .text-2xl {
            font-size: 1.5rem;
        }
        
        /* Improved card spacing */
        .grid {
            gap: 0.75rem;
        }
    }
    
    /* Smooth animations */
    .transition-colors {
        transition: background-color 0.2s ease-in-out;
    }
    
    /* Better hover states for mobile */
    @media (hover: hover) {
        .hover\:bg-green-600:hover {
            background-color: rgb(22 163 74);
        }
    }
    
    /* Touch feedback */
    .bg-green-500:active {
        background-color: rgb(20 150 70);
    }
    
    .bg-blue-500:active {
        background-color: rgb(30 100 200);
    }
</style>

<script>
    // Mobile-specific enhancements
    document.addEventListener('DOMContentLoaded', function() {
        // Add touch feedback for buttons
        const buttons = document.querySelectorAll('a, button');
        buttons.forEach(button => {
            button.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.95)';
            });
            
            button.addEventListener('touchend', function() {
                this.style.transform = 'scale(1)';
            });
        });
        
        // Optimize for viewport
        const viewport = document.querySelector('meta[name=viewport]');
        if (viewport) {
            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
        }
    });
</script>
{% endblock %}